!function(e,t){function r(){this._thens=[],this._arg=null}var n={addEventListener:function(e,r,n){n=n||t,n.addEventListener?n.addEventListener(e,r,!1):n.attachEvent("on"+e,r)},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.toString(e)},toArray:function(e){return Array.prototype.slice.call(e)},parseQueryString:function(e){for(var t=e.split("&"),r={},n=0;n<t.length;n++){var i=t[n].split("=",2);r[i[0]]=decodeURIComponent(i[1])}return r},getHostName:function(t){if(!t)return"";var r=e.createElement("a");return r.href=t,r.hostname},each:function(e,t,r){if(e)if(e.length===+e.length){for(var n=0,i=e.length;n<i;n++)if(!1===t.call(r,e[n],n,e))return}else for(var a in e)if(e.hasOwnProperty(a)&&!1===t.call(r,e[a],a,e))return},extend:function(e){return e=e||{},n.each(n.toArray(arguments).slice(1),function(t){n.each(t,function(t,r){e[r]=t})}),e},css:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e.style[r]=t[r])},jsonp:function(r,n,i){function a(){c||(c=!0,d||i(r),o.parentNode.removeChild(o))}var o=e.createElement("script"),d=!1,c=!1,s="callback"+String(Math.random()).slice(2,10);r+=~r.indexOf("?")?"&":"?",r+="callback="+s,t[s]=function(e){c||(t[s]=null,d=!0,n(e))},o.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,setTimeout(a,0))},o.onload=o.onerror=a,o.src=r;var u=e.getElementsByTagName("head")[0]||e.body;u.appendChild(o)},toParams:function(e){var t,r,n=[],i=function(e,t){var r,n=[];if(t===!0?t="1":t===!1&&(t="0"),"function"==typeof t&&(t=t()),null!==t&&"object"==typeof t){for(r in t)t.hasOwnProperty(r)&&null!==t[r]&&n.push(i(e+"["+r+"]",t[r]));return n.join("&")}if("function"!=typeof t)return encodeURIComponent(e)+"="+encodeURIComponent(t);throw new Error};for(r in e)if(e.hasOwnProperty(r)){t=e[r];var a=i(r,t);a&&n.push(a)}return n.join("&")},setHTML:function(t,r){function n(){return c.replace(/<script/g,'<script data-written="1"')}function a(e){function t(){r||(r=!0,c&&e.insertAdjacentHTML("afterend",n()),o())}var r=!1;e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,setTimeout(t,0))},e.onload=e.onerror=t}function o(){e.write=function(e){c+=e};for(var r=t.getElementsByTagName("script"),i=0;i<r.length;i++){var s=r[i];if(s.getAttribute("data-written")){if("text/rocketscript"===s.type){s.type="text/javascript";var u=s.getAttribute("data-rocketsrc");u&&(s.src=u)}if(!s.type||"text/javascript"==s.type){c="";var l=s.text||s.textContent||s.innerHTML||"",f=e.createElement("script");if(f.type=s.type,f.text=l,s.src&&(f.src=s.src,a(f)),s.parentNode.replaceChild(f,s),f.src)return;if(c){f.insertAdjacentHTML("afterend",n());try{o()}catch(e){console.error(e)}return}}}}e.write=d,t.removeChild(t.firstChild)}if(r){r="<i>&nbsp;</i>"+r,t.innerHTML=r.replace(/<!--script-->/g,"<script").replace(/<!--\/script-->/g,"</script>").replace(/<script/g,'<script data-written="1"');var d=e.write,c="";i.bodyPromise.then(function(){o(t)})}},getOffset:function(r){var n=r.getBoundingClientRect(),i=e.body,a=e.documentElement,o=t.pageYOffset||a.scrollTop||i.scrollTop,d=t.pageXOffset||a.scrollLeft||i.scrollLeft,c=a.clientTop||i.clientTop||0,s=a.clientLeft||i.clientLeft||0,u=n.top+o-c,l=n.left+d-s;return{top:Math.round(u),left:Math.round(l)}},getWindowSize:function(){return{width:t.innerWidth||e.documentElement.clientWidth,height:t.innerHeight||e.documentElement.clientHeight}}};r.prototype={then:function(e,t){this._thens.push({resolve:e,reject:t})},done:function(e){this.then(function(t){e(null,t)},function(t){e(t)})},resolve:function(e){this._complete("resolve",e)},reject:function(e){this._complete("reject",e)},_resolve:function(e){e&&e(this._arg)},_reject:function(e,t){t&&t(this._arg)},_complete:function(e,t){this._arg=t,this.then="resolve"===e?this._resolve:this._reject,this.resolve=this.reject=function(){};for(var r,n=0;r=this._thens[n++];)r[e]&&r[e](t);delete this._thens}};var i={initialized:!1,bodyPromise:new r,uidPromise:new r,places:{},checkBody:function(){e.body?i.bodyPromise.resolve():setTimeout(i.checkBody,1)},guessUid:function(){return t.localStorage?t.postMessage?(n.addEventListener("message",function(e){if(n.getHostName(e.origin)==a.uidHost){var t=e.data.match(/^dumedia-uid=([a-z0-9]*)$/);t&&i.uidPromise.resolve(t[1])}}),void i.uidPromise.resolve("")):void i.uidPromise.reject(new Error("PostMessage is not supported")):void i.uidPromise.reject(new Error("Local Storage is not supported"))},buildTrackParameters:function(r,i,a){if(!r)throw new Error("Client code is not defined");var o="dumediaFirstReferrer",d=0,c="",s=t.localStorage;if(s)try{var u=(e.referrer.split("/")[2]||"").replace(/^www\./,"");c=s.getItem(o)||"";var l=e.location.hostname.replace(/^www\./,"");u&&c!==e.referrer&&u!==l&&(s.setItem(o,e.referrer),c=e.referrer,d=1)}catch(e){}var f={clientCode:r,level:i,fsdt:d};switch(f.level){case"main":break;case"category":var p=a.category||a.ad_category||t.ad_category||null;if(!p)throw new Error("ad_category is not defined");f.id=p;break;case"product":var h=a.product||a.ad_product||t.ad_product||null;if(!h)throw new Error("ad_product is not defined");f.id=h.id;break;case"basket":case"buy":var m=a.products||a.ad_products||t.ad_products||[];if(!n.isArray(m))throw new Error("ad_products is not array");f.id=[],f.cnt=[];for(var g=0;g<m.length;g++)f.id.push(m[g].id),f.cnt.push(m[g].number||1);f.id=f.id.join(","),f.cnt=f.cnt.join(","),f.sum=a.ad_amount||t.ad_amount||0,f.orderId=a.ad_order||t.ad_order||""}return f.sourceDomain=n.getHostName(c),f.url=e.location.href,f.referrer=e.referrer,(a.known_user||a.ad_known_user||t.ad_known_user)&&(f.knownUser=1),f},initTracks:function(){var e=t._dmTrack||[];"object"==typeof t.dumedia&&t.dumedia.code&&e.push(t.dumedia),t._dmTrack=e,e.push=function(){for(var t=0;t<arguments.length;t++)i.track(arguments[t]);Array.prototype.push.apply(e,Array.prototype.slice.call(arguments))};for(var r=0;r<e.length;r++)i.track(e[r])},track:function(t){var r=i.buildTrackParameters(t.code,t.level,t),o=e.createElement("script");o.src="//"+a.trackHost+"/track?"+n.toParams(r),i.uidPromise.done(function(){e.body.appendChild(o)})},loadAd:function(e){if(!e.dumediaInitialized){e.dumediaInitialized=!0;var t=function(){i.showGag(e)};i.uidPromise.done(function(r,o){var d=i.buildAdParams(e,{jsuid:o||""});n.jsonp("//"+a.adHost+"/dmd/prepare?"+n.toParams(d),function(t){t.error?i.showGag(e,t.html):n.setHTML(e,t.html)},t)})}},buildAdParams:function(t,r){var i={};if(t.getAttribute("data-dumedia-extra")){i.extra={};for(var a=t.getAttribute("data-dumedia-extra").split("&"),o=0;o<a.length;o++){var d=a[o].split("=",2);""!==d[0]&&(i.extra[d[0]]=d[1])}}var c=n.getOffset(t),s=n.getWindowSize();return n.extend({},r,{place:t.getAttribute("data-dumedia-adv")||"",siteCode:t.getAttribute("data-dumedia-site")||"",width:t.getAttribute("data-width")||t.offsetWidth,height:t.getAttribute("data-height")||t.offsetHeight,subid:t.getAttribute("data-dumedia-subid")||"",f:top==self?0:1,vw:s.width,vh:s.height,ox:c.left,oy:c.top,rnd:Math.random(),text:t.getAttribute("data-text")||"",ref:e.location.href},i)},findAdElements:function(){var r=t._dmPlaces;if(r){for(var n=0;n<r.length;n++){var a=r[n];"number"==typeof a&&(a={place:a});var o=e.createElement("div");o.setAttribute("data-dumedia-adv",a.place),o.setAttribute("data-dumedia-subid",a.subid||""),e.body.appendChild(o)}t._dmPlaces=[]}for(var d=e.getElementsByTagName("div"),c=[],n=0,s=d.length;n<s;n++){var u=d[n],l=u.getAttribute("data-dumedia-adv"),f=u.getAttribute("data-dumedia-site");(!l&&f||l&&!i.places[l])&&(c.push(u),l&&(i.places[l]=u))}return c},showGag:function(e,t){for(var r=e.getElementsByTagName("script"),i=0;i<r.length;i++){var a=r[i];if("text/x-dumedia-gag"==a.type){t=a.innerHTML;break}}if("function"==typeof e.dumediaGag){var o=e.dumediaGag(t);"string"==typeof o&&(t=o)}t&&n.setHTML(e,t)},updateAd:function(){for(var e=i.findAdElements(),t=0;t<e.length;t++)i.loadAd(e[t])},run:function(){i.initialized||(i.initialized=!0,i.checkBody(),i.bodyPromise.then(i.guessUid),i.initTracks(),i.bodyPromise.then(function(){setInterval(i.updateAd,1e3),i.updateAd()}))}},a={debug:!1,uidHost:"track.dumedia.ru",trackHost:"track.dumedia.ru",adHost:"ad.dumedia.ru"};a=n.extend(a,t.dumedia_config),i.run()}(document,window);